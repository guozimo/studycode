/*! grafana - v2.0.2 - 2015-04-22
 * Copyright (c) 2015 Torkel Ã–degaard; Licensed Apache License */

define(["helpers","features/dashboard/shareModalCtrl"],function(a){"use strict";describe("ShareModalCtrl",function(){function b(a){c.timeSrv.timeRangeForUrl=sinon.stub().returns(a)}var c=new a.ControllerTestContext;b({from:"now-1h",to:"now"}),beforeEach(module("grafana.controllers")),beforeEach(c.providePhase()),beforeEach(c.createControllerPhase("ShareModalCtrl")),describe("shareUrl with current time range and panel",function(){it("should generate share url relative time",function(){c.$location.path("/test"),c.scope.panel={id:22},b({from:"now-1h",to:"now"}),c.scope.init(),expect(c.scope.shareUrl).to.be("http://server/#/test?from=now-1h&to=now&panelId=22&fullscreen")}),it("should generate share url absolute time",function(){c.$location.path("/test"),c.scope.panel={id:22},b({from:13621788e5,to:13966488e5}),c.scope.init(),expect(c.scope.shareUrl).to.be("http://server/#/test?from=1362178800000&to=1396648800000&panelId=22&fullscreen")}),it("should remove panel id when no panel in scope",function(){c.$location.path("/test"),c.scope.options.forCurrent=!0,c.scope.panel=null,b({from:"now-1h",to:"now"}),c.scope.init(),expect(c.scope.shareUrl).to.be("http://server/#/test?from=now-1h&to=now")}),it("should add theme when specified",function(){c.$location.path("/test"),c.scope.options.theme="light",c.scope.panel=null,b({from:"now-1h",to:"now"}),c.scope.init(),expect(c.scope.shareUrl).to.be("http://server/#/test?from=now-1h&to=now&theme=light")}),it("should include template variables in url",function(){c.$location.path("/test"),c.scope.options.includeTemplateVars=!0,c.templateSrv.variables=[{name:"app",current:{text:"mupp"}},{name:"server",current:{text:"srv-01"}}],b({from:"now-1h",to:"now"}),c.scope.buildUrl(),expect(c.scope.shareUrl).to.be("http://server/#/test?from=now-1h&to=now&var-app=mupp&var-server=srv-01")})})})});